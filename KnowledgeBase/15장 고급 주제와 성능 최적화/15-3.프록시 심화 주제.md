# âœ” í”„ë¡ì‹œ ì‹¬í™” ì£¼ì œ

- [1. ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì™€ í”„ë¡ì‹œ](#1-ì˜ì†ì„±-ì»¨í…ìŠ¤íŠ¸ì™€-í”„ë¡ì‹œ)
- [2. í”„ë¡ì‹œ íƒ€ì… ë¹„êµ](#2-í”„ë¡ì‹œ-íƒ€ì…-ë¹„êµ)
- [3. í”„ë¡ì‹œ ë™ë“±ì„± ë¹„êµ](#3-í”„ë¡ì‹œ-ë™ë“±ì„±-ë¹„êµ)
- [4. ìƒì†ê´€ê³„ì™€ í”„ë¡ì‹œ](#4-ìƒì†ê´€ê³„ì™€-í”„ë¡ì‹œ)
    - [JPQLë¡œ ëŒ€ìƒ ì§ì ‘ ì¡°íšŒ](#jpqlë¡œ-ëŒ€ìƒ-ì§ì ‘-ì¡°íšŒ)
    - [í”„ë¡ì‹œ ë²—ê¸°ê¸°](#í”„ë¡ì‹œ-ë²—ê¸°ê¸°)
    - [ê¸°ëŠ¥ì„ ìœ„í•œ ë³„ë„ì˜ ì¸í„°í˜ì´ìŠ¤ ì œê³µ](#ê¸°ëŠ¥ì„-ìœ„í•œ-ë³„ë„ì˜-ì¸í„°í˜ì´ìŠ¤-ì œê³µ)
    - [ë¹„ì§€í„° íŒ¨í„´ ì‚¬ìš©](#ë¹„ì§€í„°-íŒ¨í„´-ì‚¬ìš©)   
    
í”„ë¡ì‹œëŠ” ì›ë³¸ ì—”í‹°í‹°ë¥¼ ìƒì†ë°›ì•„ì„œ ë§Œë“¤ì–´ì§€ë¯€ë¡œ ì—”í‹°í‹°ë¥¼ ì‚¬ìš©í•˜ëŠ” í´ë¼ì´ì–¸íŠ¸ëŠ” ì—”í‹°í‹°ê°€ í”„ë¡ì‹œì¸ì§€ ì›ë³¸ ì—”í‹°í‹°ì¸ì§€ êµ¬ë¶„í•˜ì§€ ì•Šê³  ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.  
ë”°ë¼ì„œ ì›ë³¸ ì—”í‹°í‹°ë¥¼ ì‚¬ìš©í•˜ë‹¤ê°€ ì§€ì—° ë¡œë”©ì„ í•˜ë ¤ê³  í”„ë¡ì‹œë¡œ ë³€ê²½í•´ë„ í´ë¼ì´ì–¸íŠ¸ì˜ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ìˆ˜ì •í•˜ì§€ ì•Šì•„ë„ ëœë‹¤.   
í•˜ì§€ë§Œ í”„ë¡ì‹œë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ì‹ì˜ ê¸°ìˆ ì ì¸ í•œê³„ë¡œ ì¸í•´ ì˜ˆìƒí•˜ì§€ ëª»í•œ ë¬¸ì œë“¤ì´ ë°œìƒí•˜ê¸°ë„ í•œë‹¤.

## 1. ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì™€ í”„ë¡ì‹œ
ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ëŠ” ìì‹ ì´ ê´€ë¦¬í•˜ëŠ” ì˜ì† ì—”í‹°í‹°ì˜ ë™ì¼ì„±ì„ ë³´ì¥í•œë‹¤.   
í”„ë¡ì‹œë¡œ ì¡°íšŒí•œ ì—”í‹°í‹°ì˜ ë™ì¼ì„±ë„ ë³´ì¥í• ê¹Œ?
```java
@Test
public void persistContextAndProxy(){
    Member newMember = new Member("member1", "íšŒì›1");
    em.persist(newMember);
    em.flush();
    em.clear();

    Member refMember = em.getReference(Member.class, "member1");
    Member findMember = em.find(Member.class, "member1");

    System.out.println("refMember Type = " + refMember.getClass());
    System.out.println("findMember Type = " + findMember.getClass());

    Assert.assertTrue(refMember == findMember); //ì„±ê³µ
}
```
ì¶œë ¥ ê²°ê³¼   
```
refMember Type = class jpabook.advanced.Member_$$_jvst843_0
findMember Type = class jpabook.advanced.Member_$$_jvst843_0
```

ë¨¼ì € member1ì„ `em.getReference()`ë¥¼ ì‚¬ìš©í•´ í”„ë¡ì‹œë¡œ ì¡°íšŒí–ˆë‹¤.   
ë‹¤ìŒìœ¼ë¡œ ê°™ì€ member1ì„ `em.find()`ë¥¼ ì‚¬ìš©í•´ ì¡°íˆí–ˆë‹¤.   
`refMember`ëŠ” í”„ë¡ì‹œê³  `findMember`ëŠ” ì›ë³¸ ì—”í‹°í‹°ì´ë¯€ë¡œ ì„œë¡œ ë‹¤ë¥¸ ì¸ìŠ¤í„´ìŠ¤ë¡œ ìƒê°í•  ìˆ˜ ìˆì§€ë§Œ ì´ë ‡ê²Œ ë˜ë©´ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ê°€ ì˜ì† ì—”í‹°í‹°ì˜ ë™ì¼ì„±ì„ ë³´ì¥í•˜ì§€ ëª»í•˜ëŠ” ë¬¸ì œê°€ ë°œìƒí•œë‹¤.  

ê·¸ë˜ì„œ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ëŠ” í”„ë¡ì‹œë¡œ ì¡°íšŒëœ ì—”í‹°í‹°ì— ëŒ€í•´ì„œ ê°™ì€ ì—”í‹°í‹°ë¥¼ ì°¾ëŠ” ìš”ì²­ì´ ì˜¤ë©´ ì›ë³¸ ì—”í‹°í‹°ê°€ ì•„ë‹Œ ì²˜ìŒ ì¡°íšŒëœ í”„ë¡ì‹œë¥¼ ë°˜í™˜í•œë‹¤.   
ì½”ë“œì—ì„œ member1 ì—”í‹°í‹°ë¥¼ í”„ë¡ì‹œëŸ¬ ì²˜ìŒ ì¡°íšŒí–ˆê¸° ë•Œë¬¸ì— ì´í›„ì— `em.find()`ë¥¼ ì‚¬ìš©í•´ì„œ ê°™ì€ member1ì„ ì°¾ì•„ë„ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ëŠ” ì›ë³¸ì´ ì•„ë‹Œ í”„ë¡ì‹œë¥¼ ë°˜í™˜í•œë‹¤.   
ì¶œë ¥ ê²°ê³¼ë¥¼ ë³´ë©´ `$$_jvst843_0`ì´ ë¶™ì–´ìˆìœ¼ë¯€ë¡œ í”„ë¡ì‹œë¡œ ì¡°íšŒëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤. ê·¸ë¦¬ê³  ë§ˆì§€ë§‰ì— `assertTrue` ê²€ì¦ ì½”ë“œë¥¼ í†µí•´ ë‘˜ì´ ê°™ì€ ì¸ìŠ¤í„´ìŠ¤ì¸ ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤.   

ë”°ë¼ì„œ í”„ë¡ì‹œë¡œ ì¡°íšŒí•´ë„ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ëŠ” ì˜ì† ì—”í‹°í‹°ì˜ ë™ì¼ì„±ì„ ë³´ì¥í•œë‹¤.

```java
//ì›ë³¸ ë¨¼ì € ì¡°íšŒí•˜ê³  ë‚˜ì„œ í”„ë¡ì‹œë¡œ ì¡°íšŒ
@Test
public void persistContextAndProxy2(){
    Member newMember = new Member("member1", "íšŒì›1");
    em.persist(newMember);
    em.flush();
    em.clear();

    Member findMember = em.find(Member.class, "member1");
    Member refMember = em.getReference(Member.class, "member1");

    System.out.println("refMember Type = " + refMember.getClass());
    System.out.println("findMember Type = " + findMember.getClass());

    Assert.assertTrue(refMember == findMember); //ì„±ê³µ
}
```
```
ì¶œë ¥ ê²°ê³¼
refMember Type = class jpabook.advanced.Member
findMember Type = class jpabook.advanced.Member
```
**ì›ë³¸ ì—”í‹°í‹°ë¥¼ ë¨¼ì € ì¡°íšŒí•˜ë©´ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ëŠ” ì›ë³¸ ì—”í‹°í‹°ë¥¼ ì´ë¯¸ DBì—ì„œ ì¡°íšŒí–ˆìœ¼ë¯€ë¡œ í”„ë¡ì‹œë¥¼ ë°˜í™˜í•  ì´ìœ ê°€ ì—†ë‹¤.**   
ë”°ë¼ì„œ `em.getReference()`ë¥¼ í˜¸ì¶œí•´ë„ í”„ë¡ì‹œê°€ ì•„ë‹Œ ì›ë³¸ì„ ë°˜í™˜í•œë‹¤. ë¬¼ë¡  ì´ ê²½ìš°ì—ë„ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ëŠ” ìì‹ ì´ ê´€ë¦¬í•˜ëŠ” ì˜ì† ì—”í‹°í‹°ì˜ ë™ì¼ì„±ì„ ë³´ì¥í•œë‹¤.

## 2. í”„ë¡ì‹œ íƒ€ì… ë¹„êµ
í”„ë¡ì‹œëŠ” ì›ë³¸ ì—”í‹°í‹°ë¥¼ ìƒì† ë°›ì•„ì„œ ë§Œë“¤ì–´ì§€ë¯€ë¡œ í”„ë¡ì‹œë¡œ ì¡°íšŒí•œ ì—”í‹°í‹°ì˜ íƒ€ì…ì„ ë¹„êµí•  ë•ŒëŠ” `==` ë¹„êµë¥¼ í•˜ë©´ ì•ˆ ë˜ê³  `instanceof`ë¥¼ ì‚¬ìš©í•´ì•¼ í•œë‹¤.   
<div style="margin:auto;background-color:white; width:50%; height:100%; display:flex; flex-direction:column; color:black; font-size:26px;border:1px solid black;">
    <div style="text-align:center" width="200" height="200">
        Member
    </div>
    <div style="text-align:center" height="100%">
        <svg width="100%" height="100%" style="transform:rotate(270deg)">
            <defs>
                <marker id="arrow" viewBox="0 0 10 10" refX="5" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse">
                <path d="M 0 0 L 10 5 L 0 10 z" fill="#000"/> 
            </defs> 
            <line x1="40%" y1="50%" x2="55%" y2="50%" stroke="#000" stroke-width="2" marker-end="url(#arrow)" />
        </svg>
    </div>
    <div style="text-align:center" height="200">
        Member_$$_jvsteXXX
    </div>
</div>

```java
@Test
public void compareProxyType(){
    Member newMember = new Member("member1", "íšŒì›1");
    em.persist(newMember);
    em.flush();
    em.clear();

    Member refMember = em.getReference(Member.class, "member1");

    Assert.assertFalse(Member.class == refMember.getClass()); //false
    Assert.assertTrue(refMember instanceof Member);           //true
}
```
```
ì¶œë ¥ ê²°ê³¼
refMember Type = class jpabook.advanced.Member_$$_jvstXXX
```
`refMember`ì˜ íƒ€ì…ì„ ì¶œë ¥í•´ë³´ë©´ í”„ë¡ì‹œë¡œ ì¡°íšŒí–ˆìœ¼ë¯€ë¡œ ì¶œë ¥ ê²°ê³¼ ëì— í”„ë¡ì‹œë¼ëŠ” ì˜ë¯¸ì˜ `_$$_jvstXXX`ê°€ ë¶™ì–´ ìˆëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.   

`Member.class == refMember.getClass()` ë¹„êµëŠ” ë¶€ëª¨ í´ë˜ìŠ¤ì™€ ìì‹ í´ë˜ìŠ¤ë¥¼ `==` ë¹„êµí•œ ê²ƒì´ ëœë‹¤. ë”°ë¼ì„œ ê²°ê³¼ëŠ” falseë‹¤.   
**í”„ë¡ì‹œëŠ” ì›ë³¸ ì—”í‹°í‹°ì˜ ìì‹ íƒ€ì…**ì´ë¯€ë¡œ `instanceof` ì—°ì‚°ì„ ì‚¬ìš©í•˜ë©´ ëœë‹¤.

## 3. í”„ë¡ì‹œ ë™ë“±ì„± ë¹„êµ
ì—”í‹°í‹°ì˜ ë™ë“±ì„±ì„ ë¹„êµí•˜ë ¤ë©´ ë¹„ì¦ˆë‹ˆìŠ¤ í‚¤ë¥¼ ì‚¬ìš©í•´ì„œ `equals()` ë©”ì†Œë“œë¥¼ ì˜¤ë²„ë¼ì´ë”©í•˜ê³  ë¹„êµí•˜ë©´ ëœë‹¤.   
ê·¸ëŸ°ë° IDEë‚˜ ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•´ì„œ êµ¬í˜„í•œ `equals()` ë©”ì†Œë“œë¡œ ì—”í‹°í‹°ë¥¼ ë¹„êµí•  ë•Œ, ë¹„êµ ëŒ€ìƒì´ ì›ë³¸ ì—”í‹°í‹°ë©´ ë¬¸ì œê°€ ì—†ì§€ë§Œ í”„ë¡ì‹œë©´ ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤.
```java
@Entity
public class Member{

    @Id
    private String id;
    private String name;
    ...

    @Override
    public boolean equals(Object obj){
        if(this == obj) return true;
        if(obj == null) return false;
        if(this.getClass() != obj.getClass()) return false; //...1

        Member member = (Member) obj;

        // ...2
        if(name != null ? !name.equals(member.name) : member.name != null){
            return false;
        }

        return true;
    }

    @Override
    public int hashCode(){
        return name != null ? name.hashCode() : 0;
    }
}
```
íšŒì› ì—”í‹°í‹°ëŠ” name í•„ë“œë¥¼ ë¹„ì¦ˆë‹ˆìŠ¤ í‚¤ë¡œ ì‚¬ìš©í•´ì„œ `equals()` ë©”ì†Œë“œë¥¼ ì˜¤ë²„ë¼ì´ë”©í–ˆë‹¤.(nameì´ ì¤‘ë³µx ê°€ì •)
```java
@Test
public void compareProxyEquiv(){
    Member saveMember = new Member("member1", "íšŒì›1");
    em.persist(saveMember);
    em.flush();
    em.clear();

    Member newMember = new Member("member1", "íšŒì›1");
    Member refMember = em.getReference(Member.class, "member1");

    Assert.assertTrue(newMember.equals(refMember));
}
```
<p align="center"><img src="https://i.ibb.co/vzVk4dy/image.png" width="60%"/><br>í”„ë¡ì‹œ ë™ë“±ì„± ë¹„êµ</p>

ìƒˆë¡œ ìƒì„±í•œ íšŒì› `newMember`ì™€ í”„ë¡ì‹œë¡œ ì¡°íšŒí•œ íšŒì› `refMember`ì˜ `name` ì†ì„±ì€ ë‘˜ ë‹¤ íšŒì›1ë¡œ ê°™ìœ¼ë¯€ë¡œ ë™ë“±ì„± ë¹„êµë¥¼ í•˜ë©´ ì„±ê³µí•  ê²ƒ ê°™ë‹¤. ë”°ë¼ì„œ `newMember.equals(refMember)`ì˜ ê²°ê³¼ëŠ” `true`ë¥¼ ê¸°ëŒ€í–ˆì§€ë§Œ ì‹¤í–‰í•´ë³´ë©´ `false`ê°€ ë‚˜ì˜¤ë©´ì„œ í…ŒìŠ¤íŠ¸ì— ì‹¤íŒ¨í•œë‹¤. ì´ í…ŒìŠ¤íŠ¸ë¥¼ í”„ë¡ì‹œê°€ ì•„ë‹Œ ì›ë³¸ ì—”í‹°í‹°ë¥¼ ì¡°íšŒí•´ì„œ ë¹„êµí•˜ë©´ ì„±ê³µí•œë‹¤.

í”„ë¡ì‹œì™€ `equals()` ë¹„êµë¥¼ í•  ë•ŒëŠ” ëª‡ê°€ì§€ ì£¼ì˜ì ì´ ìˆë‹¤.
```java
if(this.getClass() != obj.getClass()) return false;
```
1. ì—¬ê¸°ì„œ íƒ€ì…ì„ ë™ì¼ì„±(==) ë¹„êµí•œë‹¤.   
ì•ì„œ í”„ë¡ì‹œëŠ” ì›ë³¸ì„ ìƒì†ë°›ì€ ìì‹ íƒ€ì…ì´ë¯€ë¡œ í”„ë¡ì‹œì˜ íƒ€ì…ì„ ë¹„êµí•  ë•ŒëŠ” `==` ë¹„êµê°€ ì•„ë‹Œ **`instanceof`ë¥¼ ì‚¬ìš©**í•´ì•¼ í•œë‹¤ê³  ì„¤ëª…í–ˆë‹¤.   
ë”°ë¼ì„œ ì•„ë˜ì™€ ê°™ì´ ë³€ê²½í•´ì•¼ í•œë‹¤.
    ```java
    if(!(obj instanceof Member)) return false;
    ```
```java
Member member = (Member) obj; //memberëŠ” í”„ë¡ì‹œë‹¤.

if(name != null ? !name.equals(member.name) : member.name != null){
    return false;
}
```
2. `member.name`ì„ ë³´ë©´ í”„ë¡ì‹œì˜ ë©¤ë²„ë³€ìˆ˜ì— ì§ì ‘ ì ‘ê·¼í•œë‹¤.   
    <p align="center"><img src="https://i.ibb.co/8xjTm6B/image.png" width="60%"/><br>í”„ë¡ì‹œ í•„ë“œ ì§ì ‘ ì ‘ê·¼</p>

    `equals()` ë©”ì†Œë“œë¥¼ êµ¬í˜„í•  ë•ŒëŠ” ì¼ë°˜ì ìœ¼ë¡œ ë©¤ë²„ë³€ìˆ˜ë¥¼ ì§ì ‘ ë¹„êµí•˜ëŠ”ë°, í”„ë¡ì‹œì˜ ê²½ìš°ëŠ” ë¬¸ì œê°€ ëœë‹¤.   
    **í”„ë¡ì‹œëŠ” ì‹¤ì œ ë°ì´í„°ë¥¼ ê°€ì§€ê³  ìˆì§€ ì•Šë‹¤**. ë”°ë¼ì„œ í”„ë¡ì‹œì˜ ë©¤ë²„ë³€ìˆ˜ì— ì§ì ‘ ì ‘ê·¼í•˜ë©´ ì•„ë¬´ê°’ë„ ì¡°íšŒí•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì— `member.name`ì˜ ê²°ê³¼ëŠ” `null`ì´ ë°˜í™˜ë˜ê³  `equals()`ëŠ” `false`ë¥¼ ë°˜í™˜í•˜ê²Œ ëœë‹¤.
    
    `name` ë©¤ë²„ë³€ìˆ˜ê°€ `private`ì´ë¯€ë¡œ ì¼ë°˜ì ì¸ ìƒí™©ì—ì„œëŠ” í”„ë¡ì‹œì˜ ë©¤ë²„ë³€ìˆ˜ì— ì§ì ‘ ì ‘ê·¼í•˜ëŠ” ë¬¸ì œê°€ ë°œìƒí•˜ì§€ ì•Šì§€ë§Œ `equals()` ë©”ì†Œë“œëŠ” ìì‹ ì„ ë¹„êµí•˜ê¸° ë•Œë¬¸ì— `private` ë©¤ë²„ë³€ìˆ˜ì—ë„ ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤.    
    
    í”„ë¡ì‹œì˜ ë°ì´í„°ë¥¼ ì¡°íšŒí•  ë•ŒëŠ” **ì ‘ê·¼ìë¥¼ ì‚¬ìš©**í•´ì•¼ í•œë‹¤.
    ```java
    Member member = (Member) obj;

    if(name != null ? !name.equals(member.getName()) : member.getName() != null)
        return false;
    ```
    <p align="center"><img src="https://i.ibb.co/Pc1g4DN/image.png" width="60%"/><br>í”„ë¡ì‹œ ì ‘ê·¼ì ì‚¬ìš©</p>

    ```java
    //equals() ìˆ˜ì •í•œ ì „ì²´ ì½”ë“œ
    @Override
    public boolean equals(Object obj){
        if(this == obj) return true;
        if(!(obj instanceof Member)) return false;

        Member member = (Member) obj;

        if(name != null ? !name.equals(member.getName()) : member.getName() != null){
            return false;
        }

        return true;
    }
    ```
    ìˆ˜ì •í•œ ì½”ë“œë¡œ í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ë©´ `newMember.equals(refMember)`ì˜ ê²°ê³¼ë¡œ `true`ê°€ ë°˜í™˜ë˜ê³  í…ŒìŠ¤íŠ¸ê°€ ì„±ê³µí•œë‹¤.

### ì •ë¦¬
í”„ë¡ì‹œì˜ ë™ë“±ì„± ë¹„êµ ì‹œ ì£¼ì˜ ì‚¬í•­ 2ê°€ì§€
- í”„ë¡ì‹œì˜ íƒ€ì… ë¹„êµëŠ” `==` ë¹„êµ ëŒ€ì‹  **`instanceof`ë¥¼ ì‚¬ìš©**í•´ì•¼ í•œë‹¤.
- í”„ë¡ì‹œì˜ ë©¤ë²„ë³€ìˆ˜ì— ì§ì ‘ ì ‘ê·¼í•˜ë©´ ì•ˆ ë˜ê³  ëŒ€ì‹  **ì ‘ê·¼ì ë©”ì†Œë“œë¥¼ ì‚¬ìš©**í•´ì•¼ í•œë‹¤.

## 4. ìƒì†ê´€ê³„ì™€ í”„ë¡ì‹œ
ìƒì†ê´€ê³„ë¥¼ í”„ë¡ì‹œë¡œ ì¡°íšŒí•  ë•Œ ë°œìƒí•  ìˆ˜ ìˆëŠ” ë¬¸ì œì ê³¼ í•´ê²°ë°©ì•ˆ
<p align="center"><img src="https://www.notion.so/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fbfcab644-a38d-42c6-b440-5d64cbb65ec4%2FUntitled.png?table=block&id=0ebc29e6-a7e9-4d83-a4e8-1015b3038964&spaceId=b453bd85-cb15-44b5-bf2e-580aeda8074e&width=2000&userId=80352c12-65a4-4562-9a36-2179ed0dfffb&cache=v2" width="60%"/></p>

***í”„ë¡ì‹œë¥¼ ë¶€ëª¨ íƒ€ì…ìœ¼ë¡œ ì¡°íšŒí•˜ë©´ ë¬¸ì œê°€ ë°œìƒí•œë‹¤.***
```java
@Test
public void selectParentTypeProxy(){

    //í…ŒìŠ¤íŠ¸ ë°ì´í„° ì¤€ë¹„
    Book saveBook = new Book();
    saveBook.setName("jpabook");
    saveBook.setAuthor("kim");
    em.persist(saveBook);
    em.flush();
    em.clear();

    //í…ŒìŠ¤íŠ¸ ì‹œì‘
    Item proxyItem = em.getReference(Item.class, saveBook.getId());
    System.out.println("proxyItem = " + proxyItem.getClass());

    if(proxyItem instanceof Book){
        System.out.println("proxyItem instanceof Book");
        Book book = (Book) proxyItem;
        System.out.println("ì±… ì €ì = " + book.getAuthor());
    }

    Assert.assertFalse(proxyItem.getClass() == Book.class);
    Assert.assertFalse(proxyItem instanceof Book);
    Assert.assertTrue(proxyItem instanceof item);
}
/*
ì¶œë ¥ ê²°ê³¼
proxyItem = class jpabok.proxy.advanced.item.Item_$$_jvstXXX
*/
```
`Item`ì„ ì¡°íšŒí•´ì„œ `Book` íƒ€ì…ì´ë©´ ì €ì ì´ë¦„ì„ ì¶œë ¥í•œë‹¤.   
Book íƒ€ì…ì´ë©´ ë‹¤ìš´ìºìŠ¤íŒ… í›„ ì €ìë¥¼ ì¶œë ¥í•´ì•¼ í•˜ëŠ”ë° ê¸°ëŒ€ì™€ëŠ” ë‹¤ë¥´ê²Œ ì¶œë ¥ë˜ì§€ ì•Šì•˜ë‹¤.
<p align="center"><img src="https://leejaedoo.github.io/assets/img/proxy2.jpeg" width="60%"/></p>

`em.getReference()`ë¡œ Item ì—”í‹°í‹°ë¥¼ í”„ë¡ì‹œë¡œ ì¡°íšŒí–ˆë‹¤. ì‹¤ì œ ì¡°íšŒëœ ì—”í‹°í‹°ëŠ” Bookì´ë¯€ë¡œ Book íƒ€ì…ì„ ê¸°ë°˜ìœ¼ë¡œ ì›ë³¸ ì—”í‹°í‹° ì¸ìŠ¤í„´ìŠ¤ê°€ ìƒì„±ëœë‹¤.   
ê·¸ëŸ°ë° `em.getReference()`ì—ì„œ Item ì—”í‹°í‹°ë¥¼ ëŒ€ìƒìœ¼ë¡œ ì¡°íšŒí–ˆìœ¼ë¯€ë¡œ í”„ë¡ì‹œì¸ proxyItemì€ Item íƒ€ì…ì„ ê¸°ë°˜ìœ¼ë¡œ ë§Œë“¤ì–´ì§„ë‹¤. ì´ í”„ë¡ì‹œ í´ë˜ìŠ¤ëŠ” ì›ë³¸ ì—”í‹°í‹°ë¡œ Book ì—”í‹°í‹°ë¥¼ ì°¸ì¡°í•œë‹¤.   
ì¶œë ¥ ê²°ê³¼ì™€ ê·¸ë¦¼ì„ ë³´ë©´ proxyItemì´ Bookì´ ì•„ë‹Œ Item í´ë˜ìŠ¤ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë§Œë“¤ì–´ì§„ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤. ì´ëŸ° ì´ìœ ë¡œ ê¸°ëŒ€ì™€ëŠ” ë‹¤ë¥´ê²Œ falseë¥¼ ë°˜í™˜í•œë‹¤.   
ì™œëƒí•˜ë©´ í”„ë¡ì‹œì¸ proxyItemì€ `Item$Proxy` íƒ€ì…ì´ê³  ì´ íƒ€ì…ì„ Book íƒ€ì…ê³¼ ê´€ê³„ê°€ ì—†ê¸° ë•Œë¬¸ì´ë‹¤.
```java
proxyItem instanceof Book //false
```

ë”°ë¼ì„œ ì§ì ‘ ë‹¤ìš´ìºìŠ¤íŒ…ì„ í•´ë„ ë¬¸ì œê°€ ë°œìƒí•œë‹¤. 
```java
Book book = (Book) proxyItem; //java.lang.ClassCastException
```
if ë¬¸ì„ ì œê±°í•˜ë©´ proxyItemì€ Book íƒ€ì…ì´ ì•„ë‹Œ Item íƒ€ì…ì„ ê¸°ë°˜ìœ¼ë¡œ í•œ `Item$Proxy` íƒ€ì…ì´ê¸° ë•Œë¬¸ì— `ClassCastException` ì˜ˆì™¸ê°€ ë°œìƒí•œë‹¤.

ë‚´ìš©ì„ ì •ë¦¬í•˜ë©´   
í”„ë¡ì‹œë¥¼ ë¶€ëª¨ íƒ€ì…ìœ¼ë¡œ ì¡°íšŒí•˜ë©´ ë¶€ëª¨ì˜ íƒ€ì…ì„ ê¸°ë°˜ìœ¼ë¡œ í”„ë¡ì‹œê°€ ìƒì„±ë˜ëŠ” ë¬¸ì œê°€ ìˆë‹¤.
- `instanceonf` ì—°ì‚°ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤.
- í•˜ìœ„ íƒ€ì…ìœ¼ë¡œ ë‹¤ìš´ìºìŠ¤íŒ…ì„ í•  ìˆ˜ ì—†ë‹¤.

í”„ë¡ì‹œë¥¼ ë¶€ëª¨ íƒ€ì…ìœ¼ë¡œ ì¡°íšŒí•˜ëŠ” ë¬¸ì œëŠ” ì£¼ë¡œ ë‹¤í˜•ì„±ì„ ë‹¤ë£¨ëŠ” ë„ë©”ì¸ ëª¨ë¸ì—ì„œ ë‚˜íƒ€ë‚œë‹¤.
```java
@Entity
public class OrderItem{

    @Id @GeneratedValue
    private Long id;

    @ManyToOne(fetch = FetcyType.LAZY)
    @JoinColumn(name = "ITEM_ID")
    private Item item;

    public Item getItem(){
        return item;
    }

    public void setItem(Item item){
        this.item = item;
    }
}
```
`OrderItem.item`ì„ ì§€ì—° ë¡œë”©ìœ¼ë¡œ ì„¤ì •í•´ì„œ í”„ë¡ì‹œë¡œ ì¡°íšŒëœë‹¤.
```java
//ë‹¤í˜•ì„±ê³¼ í”„ë¡ì‹œ ì¡°íšŒ
@Test
public void inheritanceProxyDomain(){
    
    //í…ŒìŠ¤íŠ¸ ë°ì´í„° ì¤€ë¹„
    Book book = new Book();
    book.setName("jpabook");
    book.setAuthor("kim");
    em.persist(book);

    OrderItem saveOrderItem = new OrderItem();
    saveOrderItem.setItem(book);
    em.persist(saveOrderItem);

    em.flush();
    em.clear();

    //í…ŒìŠ¤íŠ¸ ì‹œì‘
    OrderItem orderItem = em.find(OrderItem.class, saveOrderITem.getId());
    Item item = orderItem.getItem();

    System.out.println("item = " + item.getClass());

    //ê²°ê³¼ ê²€ì¦
    Assert.assertFalse(item.getClass() == Book.class);
    Assert.assertFalse(item instanceof Book);
    Assert.assertTrue(item instanceof Item);
}

/*
ì¶œë ¥ ê²°ê³¼
item = class jpabook.proxy.advanced.item.Item_$$_jvstffa_3
*/
```
OrderItemê³¼ ì—°ê´€ëœ **Itemì„ ì§€ì—° ë¡œë”©**ìœ¼ë¡œ ì„¤ì •í–ˆìœ¼ë¯€ë¡œ ì¶œë ¥ ê²°ê³¼ì— **itemì´ í”„ë¡ì‹œë¡œ ì¡°íšŒ**ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤. ë”°ë¼ì„œ `item instanceof Book` ì—°ì‚°ë„ `false`ë¥¼ ë°˜í™˜í•œë‹¤.   

### ìƒì† ê´€ê³„ì—ì„œ ë°œìƒí•˜ëŠ” í”„ë¡ì‹œ ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ” ë°©ë²•
### JPQLë¡œ ëŒ€ìƒ ì§ì ‘ ì¡°íšŒ
ê°€ì¥ ê°„ë‹¨í•œ ë°©ë²•ì€ ì²˜ìŒë¶€í„° ìì‹ íƒ€ì…ì„ ì§ì ‘ ì¡°íšŒí•´ì„œ í•„ìš”í•œ ì—°ì‚°ì„ í•˜ë©´ ëœë‹¤.(ë‹¤í˜•ì„± í™œìš©x)
```java
String jpql = "SELECT b FROM Book b WHERE b.id = :bookId";
Book jpqlBook = em.createQuery(jpql, Book.class)
                  .setParameter("bookId", item.getId())
                  .getSingleResult();
```

### í”„ë¡ì‹œ ë²—ê¸°ê¸°
í•˜ì´ë²„ë„¤ì´íŠ¸ê°€ ì œê³µí•˜ëŠ” ê¸°ëŠ¥ì„ ì‚¬ìš©í•´ í”„ë¡ì‹œì—ì„œ ì›ë³¸ ì—”í‹°í‹°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤.
```java
Item item = orderItem.getItem();
Item unProxyItem = unProxy(item);

if (unProxyItem instanceof Book){
    System.out.println("proxyItem instanceof Book");
    Book book = (Book) unProxyItem;
    System.out.println("ì±… ì €ì = " + book.getAuthor());
}

Assert.assertTrue(item != unProxyItem);

//í•˜ì´ë²„ë„¤ì´íŠ¸ê°€ ì œê³µí•˜ëŠ” í”„ë¡ì‹œì—ì„œ ì›ë³¸ ì—”í‹°í‹°ë¥¼ ì°¾ëŠ” ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ëŠ” ë©”ì†Œë“œ
public static <T> T unProxy(Object entity){
    if(entity instanceof HibernateProxy){
        entity = ((HibernateProxy) entity).getHibernateLazyInitializer()
                                          .getImplemetation();
    }

    return (T) entity;
}

/*
ì¶œë ¥ ê²°ê³¼
proxyItem instanceof Book
ì±… ì €ì = shj
*/
```
ì²˜ìŒì— ì„¤ëª…í–ˆë“¯ì´ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ëŠ” í•œ ë²ˆ í”„ë¡ì‹œë¡œ ë…¸ì¶œí•œ ì—”í‹°í‹°ëŠ” ê³„ì† í”„ë¡ì‹œë¡œ ë…¸ì¶œí•œë‹¤. ê·¸ë˜ì•¼ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ê°€ ì˜ì† ì—”í‹°í‹°ì˜ ë™ì¼ì„±ì„ ë³´ì¥í•  ìˆ˜ ìˆê³ , í´ë¼ì´ì–¸íŠ¸ëŠ” ì¡°íšŒí•œ ì—”í‹°í‹°ê°€ í”„ë¡ì‹œì¸ì§€ ì•„ë‹Œì§€ êµ¬ë¶„í•˜ì§€ ì•Šê³  ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.   
*ê·¸ëŸ°ë° ì´ ë°©ë²•ì€ í”„ë¡ì‹œì—ì„œ ì›ë³¸ ì—”í‹°í‹°ë¥¼ ì§ì ‘ êº¼ë‚´ê¸° ë•Œë¬¸ì— í”„ë¡ì‹œì™€ ì›ë³¸ ì—”í‹°í‹°ì˜ ë™ì¼ì„± ë¹„êµê°€ ì‹¤íŒ¨í•œë‹¤ëŠ” ë¬¸ì œì ì´ ìˆë‹¤.*
```java
//ë”°ë¼ì„œ ì´ ì—°ì‚°ì˜ ê²°ê³¼ëŠ” falseë‹¤
item == unProxyItem
```
ì´ ë°©ë²•ì„ ì‚¬ìš©í•  ë•ŒëŠ” ì›ë³¸ ì—”í‹°í‹°ê°€ **ê¼­ í•„ìš”í•œ ê³³ì—ì„œ ì ê¹ ì‚¬ìš©**í•˜ê³  **ë‹¤ë¥¸ ê³³ì—ì„œ ì‚¬ìš©ë˜ì§€ ì•Šë„ë¡** í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•˜ë‹¤.   
ì›ë³¸ ì—”í‹°í‹°ì˜ ê°’ì„ ì§ì ‘ ë³€ê²½í•´ë„ ë³€ê²½ ê°ì§€ ê¸°ëŠ¥ì€ ë™ì‘í•œë‹¤.

### ê¸°ëŠ¥ì„ ìœ„í•œ ë³„ë„ì˜ ì¸í„°í˜ì´ìŠ¤ ì œê³µ
<p align="center"><img src="https://leejaedoo.github.io/assets/img/proxy3.jpeg" width="60%"/></p>

```java
public interface TitleView{
    String getTitle();
}

@Entity
@Inheritance(startegy = InheritanceType.SINGLE_TALBE)
@DiscriminatorColumn(name = "DTYPE")
@Getter @Setter
public abstract class Item implements TitleView{

    @Id @GeneratedValue
    @Column(name = "ITEM_ID")
    private Long id;

    private String name;
    private int price;
    private int stockQuantity;
}

@Entity
@DiscrimivatorValue("B")
public class Book extends Item{
    
    private String author;
    private String isbn;

    @Override
    publi String getTitle(){
        return "[ì œëª© : " + getName() + " ì €ì : " +  author + "]";
    }
}

@Entity
@DiscrimivatorValue("M")
public class Movie extends Item{
    
    private String director;
    private String actor;

    @Override
    publi String getTitle(){
        return "[ì œëª©:" + getName() + " ê°ë…:" +  director + " ë°°ìš°:" + actor + "]";
    }
}
```
`TitleView`ë¼ëŠ” ê³µí†µ ì¸í„°í˜ì´ìŠ¤ë¥¼ ë§Œë“¤ê³  ìì‹ í´ë˜ìŠ¤ë“¤ì€ ì¸í„°í˜ì´ìŠ¤ì™€ `getTitle()` ë©”ì†Œë“œë¥¼ ê°ê° êµ¬í˜„í–ˆë‹¤.   
ì´ì œ `OrderItem`ì—ì„œ `Item.getTitle()`ì„ í˜¸ì¶œí•˜ë©´ ëœë‹¤.
```java
@Entity
public class OrderItem{

    @Id @GeneratedValue
    private Long id;

    @ManyToOne(fetch = FetcyType.LAZY)
    @JoinColumn(name = "ITEM_ID")
    private Item item;
    ...

    public void printItem(){
        System.out.println("TITLE = " + item.getTitle());
    }
}
```
```java
OrderItem orderItem = em.find(OrderItem.class, saveOrderItem.getId());
orderItem.printItem();
```
Itemì˜ êµ¬í˜„ì²´ì— ë”°ë¼ ê°ê° ë‹¤ë¥¸ `getTitle()` ë©”ì†Œë“œê°€ í˜¸ì¶œëœë‹¤   
Book ì¡°íšŒ ì‹œ ê²°ê³¼ : `TITLE = [ì œëª©:jpabook ì €ì:kim]`   

ì´ì²˜ëŸ¼ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì œê³µí•˜ê³  ê°ê°ì˜ í´ë˜ìŠ¤ê°€ ìì‹ ì— ë§ëŠ” ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ëŠ” ê²ƒì€ ë‹¤í˜•ì„±ì„ í™œìš©í•˜ëŠ” ì¢‹ì€ ë°©ë²•ì´ë‹¤.   
ì´í›„ ë‹¤ì–‘í•œ ìƒí’ˆ íƒ€ì…ì´ ì¶”ê°€ë˜ì–´ë„ Itemì„ ì‚¬ìš©í•˜ëŠ” OrderItemì˜ ì½”ë“œëŠ” ìˆ˜ì •í•˜ì§€ ì•Šì•„ë„ ëœë‹¤. ê·¸ë¦¬ê³  ì´ ë°©ë²•ì€ í´ë¼ì´ì–¸íŠ¸ ì…ì¥ì—ì„œ ëŒ€ìƒ ê°ì²´ê°€ í”„ë¡ì‹œì¸ì§€ ì•„ë‹Œì§€ë¥¼ ê³ ë¯¼í•˜ì§€ ì•Šì•„ë„ ë˜ëŠ” ì¥ì ì´ ìˆë‹¤.   

ì´ ë°©ë²•ì„ ì‚¬ìš©í•  ë•ŒëŠ” í”„ë¡ì‹œì˜ íŠ¹ì§• ë•Œë¬¸ì— **í”„ë¡ì‹œì˜ ëŒ€ìƒì´ ë˜ëŠ” íƒ€ì…ì— ì¸í„°í˜ì´ìŠ¤ë¥¼ ì ìš©**í•´ì•¼ í•œë‹¤. ì—¬ê¸°ì„œëŠ” Itemì´ í”„ë¡ì‹œì˜ ëŒ€ìƒì´ë¯€ë¡œ Itemì´ ì¸í„°í˜ì´ìŠ¤ë¥¼ ë°›ì•„ì•¼í•œë‹¤.

### ë¹„ì§€í„° íŒ¨í„´ ì‚¬ìš©
<p align="center"><img src="https://leejaedoo.github.io/assets/img/visitor.jpg" width="60%"/></p>

**ë¹„ì§€í„° íŒ¨í„´ì€ Visitorì™€ Visitorë¥¼ ë°›ì•„ë“¤ì´ëŠ” ëŒ€ìƒ í´ë˜ìŠ¤ë¡œ êµ¬ì„±ëœë‹¤.**   
ì—¬ê¸°ì„œëŠ” Itemì´ `accept(visitor)` ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•´ì„œ `Visitor`ë¥¼ ë°›ì•„ë“¤ì¸ë‹¤.   
Itemì€ ë‹¨ìˆœíˆ `Visitor`ë¥¼ ë°›ì•„ë“¤ì´ê¸°ë§Œ í•˜ê³  **ì‹¤ì œ ë¡œì§ì€ `Visitor`ê°€ ì²˜ë¦¬**í•œë‹¤.

#### Visitor ì •ì˜, êµ¬í˜„
```java
//Visitor ì •ì˜
public interface Visitor{
    void visit(Book book);
    void visit(Album album);
    void visit(Movie movie);
}
```
Visitorì—ëŠ” `visit()`ë¼ëŠ” ë©”ì†Œë“œë¥¼ ì •ì˜í•˜ê³  ëª¨ë“  ëŒ€ìƒ í´ë˜ìŠ¤ë¥¼ ë°›ì•„ë“¤ì´ë„ë¡ ì‘ì„±í•˜ë©´ ëœë‹¤. ì—¬ê¸°ì„œëŠ” Book, Album, Movieë¥¼ ëŒ€ìƒ í´ë˜ìŠ¤ë¡œ ì‚¬ìš©í•œë‹¤.
```java
//Visitor êµ¬í˜„
public class PrintVisitor implements Visitor{

    @Override
    public void visit(Book book){
        //ë„˜ì–´ì˜¤ëŠ” bookì€ proxyê°€ ì•„ë‹Œ ì›ë³¸ ì—”í‹°í‹°ë‹¤.
        System.out.println("book.class = " + book.getClass());
        System.out.println("[PrintVisitor] [ì œëª©:" + book.getName() + "ì €ì:" + book.getAuthor() + "]");
    }

    @Override
    public void visit(Album album) {...}

    @Override
    public void visit(Movie movie) {...}
}

public class TitleVisitor implements Visitor{

    private String title;

    public String getTitle(){
        return title;
    }

    @Override
    public void visit(Book book){
        title = "[ì œëª©:" + book.getName() + "ì €ì:" + book.getAuthor() + "]";
    }

    @Override
    public void visit(Album album) {...}

    @Override
    public void visit(Movie movie) {...}
}
```
Visitorì˜ êµ¬í˜„ í´ë˜ìŠ¤ë¡œ ëŒ€ìƒ í´ë˜ìŠ¤ì˜ ë‚´ìš©ì„ ì¶œë ¥í•´ì£¼ëŠ” `PrintVisitor`ì™€ `TitleVisitor`ë¥¼ ì‘ì„±í–ˆë‹¤.

#### ëŒ€ìƒ í´ë˜ìŠ¤ ì‘ì„±
Itemì— Visitorë¥¼ ë°›ì•„ë“¤ì¼ ìˆ˜ ìˆë„ë¡ `accept(visitor)` ë©”ì†Œë“œ ì¶”ê°€
```java
@Entity
@Inheritance(startegy = InheritanceType.SINGLE_TALBE)
@DiscriminatorColumn(name = "DTYPE")
public abstract class Item{

    @Id @GeneratedValue
    @Column(name = "ITEM_ID")
    private Long id;

    private String name;
    ...

    public abstract void accept(Visitor visitor);
}

@Entity
@DiscrimivatorValue("B")
public class Book extends Item{
    
    private String author;
    private String isbn; //Getter, Setter

    publi String getAuthor(){
        return author;
    }

    @Override
    public void accept(Visitor visitor){
        visitor.visit(this);
    }
}

@Entity
@DiscrimivatorValue("M")
public class Movie extends Item{
    ...
    
    @Override
    public void accept(Visitor visitor){
        visitor.visit(this);
    }
}

@Entity
@DiscrimivatorValue("A")
public class Album extends Item{
    ...
    
    @Override
    public void accept(Visitor visitor){
        visitor.visit(this);
    }
}
```
ê°ê°ì˜ ìì‹ í´ë˜ìŠ¤ë“¤ì€ ë¶€ëª¨ì— ì •ì˜í•œ `accept(visitor)` ë©”ì†Œë“œë¥¼ êµ¬í˜„í–ˆë‹¤.   
êµ¬í˜„ ë‚´ìš©ì€ ë‹¨ìˆœíˆ íŒŒë¼ë¯¸í„°ë¡œ ë„˜ì–´ì˜¨ Visitorì˜ `visit(this)` ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•˜ë©´ì„œ ìì‹ ì„ íŒŒë¼ë¯¸í„°ë¡œ ë„˜ê¸°ëŠ” ê²ƒì´ ì „ë¶€ë‹¤. ì´ë ‡ê²Œ í•´ì„œ **ì‹¤ì œ ë¡œì§ ì²˜ë¦¬ë¥¼ visitorì— ìœ„ì„**í•œë‹¤.

#### ë¹„ì§€í„° íŒ¨í„´ ì‹¤í–‰
```java
@Test
public void inheritanceProxyVisitorPattern(){
    ...
    OrderItem orderItem = em.find(OrderItem.class, orderItemId);
    Item item = orderItem.getItem();

    //PrintVisitor
    item.accept(new PrintVisitor());
}

/*
ì¶œë ¥ ê²°ê³¼
book.class = class jpabook.advanded.item.Book
[PrintVisitor] [ì œëª©:jpabook ì €ì:kim]
*/
```
<p align="center"><img src="https://user-images.githubusercontent.com/51476083/123822551-5b1d2f00-d937-11eb-9146-1a0a5ad9b5cd.png" width="60%"/></p>

ê·¸ë¦¼ì„ í†µí•´ ë¶„ì„í•´ë³´ë©´, 
1. ë¨¼ì € `item.accept()`ë¥¼ í˜¸ì¶œí•´ íŒŒë¼ë¯¸í„°ë¡œ `PrintVisitor`ë¥¼ ë„˜ê²¨ì£¼ì—ˆë‹¤. 
2. itemì€ í”„ë¡ì‹œì´ë¯€ë¡œ ë¨¼ì € í”„ë¡ì‹œ(ProxyItem)ê°€ `accept()` ë©”ì†Œë“œë¥¼ ë°›ê³  ì›ë³¸ ì—”í‹°í‹°(book)ì˜ `accept()`ë¥¼ ì‹¤í–‰í•œë‹¤.
3. ì›ë³¸ ì—”í‹°í‹°ëŠ” ë‹¤ìŒ ì½”ë“œë¥¼ ì‹¤í–‰í•´ ìì‹ (this)ì„ visitorì— íŒŒë¼ë¯¸í„°ë¡œ ë„˜ê²¨ì¤€ë‹¤.
    ```java
    public void accept(Visitor visitor){
        visitor.visit(this); //thisëŠ” í”„ë¡ì‹œê°€ ì•„ë‹Œ ì›ë³¸ì´ë‹¤.
    }
    ```
4. visitorê°€ `PrintVisitor` íƒ€ì…ì´ë¯€ë¡œ `PrintVisitor.visit(this)` ë©”ì†Œë“œê°€ ì‹¤í–‰ë˜ëŠ”ë° ì´ë•Œ thisê°€ Book íƒ€ì…ì´ë¯€ë¡œ `visit(Book book)` ë©”ì†Œë“œê°€ ì‹¤í–‰ëœë‹¤.
    ```java
    public class PrintVisitor implements Visitor{
        public void visit(Book book){
            //ë„˜ì–´ì˜¤ëŠ” bookì€ proxyê°€ ì•„ë‹Œ ì›ë³¸ ì—”í‹°í‹°ë‹¤.
            System.out.println("book.class = " + book.getClass());
            System.out.println("[PrintVisitor] [ì œëª©:" + book.getName() + "ì €ì:" + book.getAuthor() + "]");
        }
        public void visit(Album album) {...}
        public void visit(Movie movie) {...}
    }
    ```
    ì¶œë ¥ ê²°ê³¼ë¥¼ ë³´ë©´ `Visitor.visit()`ì—ì„œ íŒŒë¼ë¯¸í„°ë¡œ ë„˜ì–´ì˜¤ëŠ” ì—”í‹°í‹°ëŠ” í”„ë¡ì‹œê°€ ì•„ë‹ˆë¼ ì‹¤ì œ ì›ë³¸ ì—”í‹°í‹°ì¸ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.   
    `book.class = class jpabook.advanced.item.Book`   

ë¹„ì§€í„° íŒ¨í„´ì„ ì‚¬ìš©í•˜ë©´ í”„ë¡ì‹œì— ëŒ€í•œ ê±±ì • ì—†ì´ ì•ˆì „í•˜ê²Œ ì›ë³¸ ì—”í‹°í‹°ì— ì ‘ê·¼í•  ìˆ˜ ìˆê³  `instanceof`ë‚˜ íƒ€ì…ìºìŠ¤íŒ… ì—†ì´ ì½”ë“œë¥¼ êµ¬í˜„í•  ìˆ˜ ì‡ëŠ” ì¥ì ì´ ìˆë‹¤.

#### ë¹„ì§€í„° íŒ¨í„´ê³¼ í™•ì¥ì„±
```java
//TitleVisitor ì‚¬ìš©
TitleVisitor titleVisitor = new TitleVisitor();
item.accept(titleVisitor);

String title = titleVisitor.getTitle();
System.out.println("TITLE = " + title);

/*
ì¶œë ¥ ê²°ê³¼
book.class = class jpabook.advanded.item.Book
TITLE = [ì œëª©:jpabook ì €ì:kim]
*/
```
***ë¹„ì§€í„° íŒ¨í„´ì€ ìƒˆë¡œìš´ ê¸°ëŠ¥ì´ í•„ìš”í•  ë•Œ Visitorë§Œ ì¶”ê°€í•˜ë©´ ëœë‹¤.***   
ê¸°ì¡´ ì½”ë“œì˜ êµ¬ì¡°ë¥¼ ë³€ê²½í•˜ì§€ ì•Šê³  ê¸°ëŠ¥ì„ ì¶”ê°€í•  ìˆ˜ ìˆëŠ” ì¥ì 

#### ğŸ“ë¹„ì§€í„° íŒ¨í„´ ì •ë¦¬
**ì¥ì **
- í”„ë¡ì‹œì— ëŒ€í•œ ê±±ì • ì—†ì´ ì•ˆì „í•˜ê²Œ ì›ë³¸ ì—”í‹°í‹°ì— ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤.
- `instenceof`ì™€ `íƒ€ì…ìºìŠ¤íŒ…` ì—†ì´ ì½”ë“œë¥¼ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤.
- ì•Œê³ ë¦¬ì¦˜ê³¼ ê°ì²´ êµ¬ì¡°ë¥¼ ë¶„ë¦¬í•´ì„œ êµ¬ì¡°ë¥¼ ìˆ˜ì •í•˜ì§€ ì•Šê³  ìƒˆë¡œìš´ ë™ì‘ì„ ì¶”ê°€í•  ìˆ˜ ìˆë‹¤.

**ë‹¨ì **
- ë„ˆë¬´ ë³µì¡í•˜ê³  [ë”ë¸” ë””ìŠ¤íŒ¨ì¹˜](https://alkhwa-113.tistory.com/entry/%EB%94%94%EC%8A%A4%ED%8C%A8%EC%B9%98-%EB%8B%A4%EC%9D%B4%EB%82%98%EB%AF%B9-%EB%94%94%EC%8A%A4%ED%8C%A8%EC%B9%98-%EB%8D%94%EB%B8%94-%EB%94%94%EC%8A%A4%ED%8C%A8%EC%B9%98)ë¥¼ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— ì´í•´í•˜ê¸° ì–´ë µë‹¤.
- ê°ì²´ êµ¬ì¡°ê°€ ë³€ê²½ë˜ë©´ ëª¨ë“  Visitorë¥¼ ìˆ˜ì •í•´ì•¼ í•œë‹¤.